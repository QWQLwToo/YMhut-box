<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>工具窗口</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../css/style.css"> <style>
        /* 确保工具内容占满窗口 */
        html, body, #app-body, .secret-window-container, .secret-content {
            height: 100%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .secret-content {
            padding: 0; /* 工具自己来控制内边距 */
        }
    </style>
</head>
<body id="app-body" class="tool-window-body"> <div id="background-layer"></div>
    
    <div class="secret-window-container">
        
        <div class="title-bar" style="border-bottom: 1px solid var(--border-color); flex-shrink: 0;">
             <span id="window-title" style="margin-left: 12px; font-weight: 600; -webkit-app-region: drag; flex-grow: 1;">正在加载工具...</span>
            <div class="window-controls">
                <button id="minimize-btn" class="window-control-btn" title="最小化">
                    <i class="fas fa-window-minimize"></i>
                </button>
                <button id="maximize-btn" class="window-control-btn" title="最大化">
                    <i class="fas fa-window-maximize"></i>
                </button>
                <button id="close-btn" class="window-control-btn" title="关闭">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>

        <div id="tool-content-area" class="secret-content" style="flex-grow: 1; min-height: 0;">
            <div class="loading-container">
                <img src="../assets/loading.gif" alt="加载中..." class="loading-gif"> <p class="loading-text">正在初始化工具模块...</p>
            </div>
        </div>
    </div>

    <div id="toast-container"></div>

    <script type="module">
        import configManager from '../js/configManager.js';
        import uiManager from '../js/uiManager.js';
        import { loadToolFromUrl } from '../js/view-loader.js';
        
        // 1. 初始化窗口 (主题, 通知, 窗口控制)
        window.uiManager = uiManager; // 将 uiManager 暴露给工具
        window.configManager = configManager; // 将 configManager 暴露给工具
        
        const params = new URLSearchParams(window.location.search);
        const theme = params.get('theme') || 'dark';
        document.body.setAttribute('data-theme', theme);
        
        // 绑定窗口控制
        document.getElementById('close-btn').addEventListener('click', () => window.electronAPI.closeCurrentWindow());
        document.getElementById('minimize-btn').addEventListener('click', () => window.electronAPI.secretWindowMinimize());
        document.getElementById('maximize-btn').addEventListener('click', () => window.electronAPI.secretWindowMaximize());

        // 2. 加载工具
        loadToolFromUrl();

        // 3. [新增] 窗口焦点追踪，用于 UI 区分
        window.addEventListener('focus', () => document.body.classList.add('window-focused'));
        window.addEventListener('blur', () => document.body.classList.remove('window-focused'));
        document.body.classList.add('window-focused'); // 默认加载时为激活状态
    </script>
</body>
</html>